generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Producto {
  ProductoID     Int      @id @default(autoincrement())
  TipoProductoID Int?
  Nombre         String?  @db.VarChar(100)
  Precio         Float?   @db.Float
  Descripcion    String?  @db.VarChar(255)
  IsActive       Boolean?
}

model TipoProducto {
  TipoProductoID Int      @id @default(autoincrement())
  Descripcion    String?  @db.VarChar(255)
  IsActive       Boolean?
}

model catalogo_bancos {
  BancoID       Int      @id @default(autoincrement())
  NombreBanco   String?  @db.VarChar(255)
  Observaciones String?  @db.VarChar(255)
  IsActive      Boolean?
}

model catalogo_clasificacion_refacciones {
  ClasificacionRefaccionID Int                   @id @default(autoincrement())
  NombreClasificacion      String?               @db.VarChar(255)
  Observaciones            String?               @db.VarChar(255)
  IsActive                 Int?                  @db.TinyInt
  refacciones              catalogo_refacciones[] @relation("ClasificacionRefacciones")
}

model catalogo_clientes {
  ClienteID         Int                        @id @default(autoincrement())
  NombreComercio    String?                    @db.VarChar(255)
  Observaciones     String?                    @db.VarChar(255)
  IsActive          Boolean?
  sucursales        clientes_sucursales[]
  presupuestos      presupuestos_encabezado[]
  equipos           equipos[]
  contratos         contratos[]
  clientes_equipos  clientes_equipos[]
  ventas            ventas_encabezado[]
}

model clientes_sucursales {
  SucursalID        Int                        @id @default(autoincrement())
  ClienteID         Int
  NombreSucursal    String                     @db.VarChar(255)
  Direccion         String?                    @db.VarChar(255)
  Ubicacion         String?                    @db.VarChar(255)
  Telefono          String?                    @db.VarChar(50)
  Contacto          String?                    @db.VarChar(255)
  Observaciones     String?                    @db.VarChar(255)
  IsActive          Boolean?                   @default(true)

  cliente           catalogo_clientes          @relation(fields: [ClienteID], references: [ClienteID])
  presupuestos      presupuestos_encabezado[]
  equipos           equipos[]
  contratos         contratos[]
  clientes_equipos  clientes_equipos[]
  ventas            ventas_encabezado[]
}

model catalogo_cuentasBancarias {
  CuentaBancariaID  Int      @id @default(autoincrement())
  BancoID           Int?
  CuentaBancaria    String?  @db.VarChar(255)
  NombrePropietario String?  @db.VarChar(255)
  Saldo             Float?   @db.Float
  IsActive          Boolean?
}

model catalogo_metodos_pago {
  MetodosDePagoID Int    @id @default(autoincrement())
  Descripcion     String @db.VarChar(255)
  EsBancario      Int?   @db.TinyInt
  IsActive        Int?   @db.TinyInt
}

model catalogo_proveedores {
  ProveedorID        Int                  @id @default(autoincrement())
  NombreProveedor    String?              @db.VarChar(255)
  Direccion          String?              @db.VarChar(255)
  Telefono           String?              @db.VarChar(255)
  Contacto           String?              @db.VarChar(255)
  Pais               String?              @db.VarChar(255)
  Correo             String?              @db.VarChar(255)
  Observaciones      String?              @db.VarChar(255)
  IsActive           Boolean?
  compras_encabezado compras_encabezado[] @relation("ProveedorCompras")
}

model catalogo_puestosTrabajo {
  PuestoTrabajoID   Int                 @id @default(autoincrement())
  PuestoTrabajo     String?             @db.VarChar(255)
  Observaciones     String?             @db.VarChar(255)
  IsActive          Boolean?
  empleados_puestos empleados_puestos[]
}

model catalogo_refacciones {
  RefaccionID                        Int                                   @id @default(autoincrement())
  ClasificacionID                    Int?
  UnidadID                           Int?
  NombrePieza                        String?                               @db.VarChar(255)
  NombreCorto                        String?                               @db.VarChar(255)
  Modelo                             String?                               @db.VarChar(255)
  Codigo                             String?                               @db.VarChar(255)
  Observaciones                      String?                               @db.VarChar(255)
  IsActive                           Boolean?
  CostoPromedio                      Float?                                @db.Float
  PrecioVenta                        Float?                                @db.Float
  PorcentajeUtilidad                 Int?
  catalogo_unidades                  catalogo_unidades?                    @relation("UnidadRefacciones", fields: [UnidadID], references: [UnidadID])
  catalogo_clasificacion_refacciones catalogo_clasificacion_refacciones?   @relation("ClasificacionRefacciones", fields: [ClasificacionID], references: [ClasificacionRefaccionID])
  inventario_tecnico                 inventario_tecnico[]
  traspasos_detalle                  traspasos_detalle[]
  refacciones_danadas                refacciones_danadas[]
  ajustes_inventario                 ajustes_inventario[]
  plantillas_equipo_detalle          plantillas_equipo_detalle[]
  equipos_detalle                    equipos_detalle[]
  presupuestos_detalle               presupuestos_detalle[]
  contratos_equipos                  contratos_equipos[]
  servicios_equipos_refacciones      servicios_equipos_refacciones[] @relation("RefaccionOriginal")
  servicios_equipos_refacciones_nueva servicios_equipos_refacciones[] @relation("RefaccionNueva")
  servicios_insumos                  servicios_insumos[]
  ventas_detalle                     ventas_detalle[]
}

model catalogo_unidades {
  UnidadID       Int                    @id @default(autoincrement())
  DesUnidad      String?                @db.VarChar(255)
  EsFraccionable Int?                   @db.TinyInt
  DecUnidad      String?                @db.VarChar(255)
  Observaciones  String?                @db.VarChar(255)
  IsActive       Boolean?
  refacciones    catalogo_refacciones[] @relation("UnidadRefacciones")
}

model clientes_correos {
  CorreoID      Int                          @id @default(autoincrement())
  ClienteID     Int?
  EmpleadoID    Int?
  Correo        String?                      @db.VarChar(255)
  TipoCorreo    clientes_correos_TipoCorreo? @default(trabajo)
  Observaciones String?                      @db.VarChar(255)
  IsActive      Boolean?
}

model clientes_datosFiscales {
  DatosFiscalesID Int      @id @default(autoincrement())
  RazonSocial     String?  @db.VarChar(255)
  RFC             String?  @db.VarChar(255)
  Regimen         String?  @db.VarChar(255)
  DireccionFiscal String?  @db.VarChar(255)
  Observaciones   String?  @db.VarChar(255)
  CodigoPostal    String?  @db.VarChar(255)
  IsActive        Boolean?
  ClienteID       Int?
}

model clientes_direcciones {
  DireccionID   Int      @id @default(autoincrement())
  ClienteID     Int?
  Direccion     String?  @db.VarChar(255)
  Ubicacion     String?  @db.VarChar(255)
  Observaciones String?  @db.VarChar(255)
  IsActive      Boolean?
}

model clientes_empleados {
  EmpleadoID        Int                 @id @default(autoincrement())
  ClienteID         Int?
  NombreEmpleado    String?             @db.VarChar(255)
  Observaciones     String?             @db.VarChar(255)
  IsActive          Boolean?
  empleados_puestos empleados_puestos[]
}

model empleados_puestos {
  EmpleadoPuestoID Int                      @id @default(autoincrement())
  EmpleadoID       Int
  PuestoTrabajoID  Int
  IsActive         Boolean?                 @default(true)

  empleado         clientes_empleados       @relation(fields: [EmpleadoID], references: [EmpleadoID])
  puesto           catalogo_puestosTrabajo  @relation(fields: [PuestoTrabajoID], references: [PuestoTrabajoID])

  @@unique([EmpleadoID, PuestoTrabajoID])
}

model clientes_telefonos {
  TelefonoID Int                      @id @default(autoincrement())
  EmpleadoID Int?
  Telefono   String?                  @db.VarChar(255)
  Tipo       clientes_telefonos_Tipo? @default(Trabajo)
  IsActive   Boolean?
}

model compras_detalle {
  CompraDetalleID     Int                 @id @default(autoincrement())
  CompraEncabezadoID  Int?
  RefaccionID         Int?
  Cantidad            Int?
  PrecioUnitario      Float?              @db.Float
  DescuentoPorcentaje Int?
  DescuentoEfectivo   Float?              @db.Float
  GastosOperativos    Float?              @db.Float
  GastosImportacion   Float?              @db.Float
  SubTotal            Float?              @db.Float
  Total               Float?              @db.Float
  IsActive            Boolean?
  compras_encabezado  compras_encabezado? @relation("CompraDetalles", fields: [CompraEncabezadoID], references: [CompraEncabezadoID])
}

model compras_encabezado {
  CompraEncabezadoID        Int                         @id @default(autoincrement())
  ProveedorID               Int?
  FechaCompra               DateTime?                   @db.Date
  TotalBruto                Float?                      @db.Float
  TotalDescuentosPorcentaje Float?                      @db.Float
  TotalDescuentoEfectivo    Float?                      @db.Float
  TotalGastosOperativos     Float?                      @db.Float
  TotalGastosImportacion    Float?                      @db.Float
  TotalIVA                  Float?                      @db.Float
  TotalNeto                 Float?                      @db.Float
  FechaAlta                 String?                     @db.VarChar(255)
  IsActive                  Boolean?
  Estatus                   compras_encabezado_Estatus?
  UsuarioID                 Int?
  compras_detalle           compras_detalle[]           @relation("CompraDetalles")
  catalogo_proveedores      catalogo_proveedores?       @relation("ProveedorCompras", fields: [ProveedorID], references: [ProveedorID])
}

model compras_recepciones_detalle {
  ComprasRecepcionesDetalleID    Int                           @id @default(autoincrement())
  ComprasRecepcionesEncabezadoID Int?
  RefaccionID                    Int?
  CantidadEstablecida            Float?                        @db.Float
  IsActive                       Int?                          @db.TinyInt
  compras_recepciones_encabezado compras_recepciones_encabezado? @relation("RecepcionDetalles", fields: [ComprasRecepcionesEncabezadoID], references: [ComprasRecepcionesEncabezadoID])
}

model compras_recepciones_encabezado {
  ComprasRecepcionesEncabezadoID Int                           @id @default(autoincrement())
  CompraEncabezadoID             Int?
  FechaRecepcion                 DateTime?                     @db.Date
  Observaciones                  String?                       @db.VarChar(255)
  MontoRecepcion                 Float?                        @db.Float
  UsuarioID                      Int?
  IsActive                       Int?                          @db.TinyInt
  compras_recepciones_detalle    compras_recepciones_detalle[] @relation("RecepcionDetalles")
}

model historial_movimientos_bancarios {
  MovimientosBancariosID Int       @id @default(autoincrement())
  CuentaBancariaID       Int?
  CuentaContableID       String?   @db.VarChar(20)
  DescripcionMovimiento  String?   @db.VarChar(255)
  FechaMovimiento        DateTime? @db.Date
  EoI                    Boolean?
  MontoMovimiento        Float?    @db.Float
  PagosID                Int?
  CobrosID               Int?
}

model inventario {
  InventarioID          Int       @id @default(autoincrement())
  RefaccionID           Int?
  UbicacionID           Int?
  StockActual           Int?
  FechaUltimoMovimiento DateTime? @db.Date
  IsActive              Int?      @db.TinyInt
}

model kardex_inventario {
  KardexInventarioID      Int                               @id @default(autoincrement())
  RefaccionID             Int?
  FechaMovimiento         DateTime?                         @db.Date
  TipoMovimiento          kardex_inventario_TipoMovimiento?
  Cantidad                Float?                            @db.Float
  CostoPromedioMovimiento Float?                            @db.Float
  UsuarioID               Int?
  Observaciones           String?                           @db.VarChar(255)
}

model modulos {
  ModuloID     Int          @id @default(autoincrement())
  NombreModulo String       @db.VarChar(255)
  Submodulos   submodulos[]
}

model pagos {
  PagosID          Int                   @id @default(autoincrement())
  ReferenciaTipo   pagos_ReferenciaTipo?
  ReferenciaID     Int?
  MetodoPagoID     Int?
  CuentaBancariaID Int?
  Monto            Float?                @db.Float
  FechaPago        DateTime?             @db.Date
  Observaciones    String?               @db.VarChar(255)
  UsuarioID        Int?
  IsActive         Int?                  @db.TinyInt
}

model permisos {
  PermisoID   Int        @id @default(autoincrement())
  UsuarioID   Int
  SubmoduloID Int
  IsActive    Boolean
  Usuario     usuarios   @relation(fields: [UsuarioID], references: [UsuarioID])
  Submodulo   submodulos @relation(fields: [SubmoduloID], references: [SubmoduloID])
}

model sesiones {
  RefreshTokenID Int      @default(autoincrement())
  RefreshToken   String?  @db.VarChar(255)
  UsuarioID      Int?
  IsActive       Boolean?
  SessionID      String   @db.VarChar(37)
  IpAdress       String?  @db.VarChar(255)
  IsActiveAdmin  Boolean?
  FechaAlta      String?  @db.VarChar(255)

  @@id([RefreshTokenID, SessionID])
}

model submodulos {
  SubmoduloID     Int        @id @default(autoincrement())
  NombreSubmodulo String     @db.VarChar(255)
  ModuloID        Int
  Ruta            String     @db.VarChar(255)
  Modulo          modulos    @relation(fields: [ModuloID], references: [ModuloID])
  Permisos        permisos[]
}

model ubicaciones_inventario {
  UbicacionID   Int                          @id @default(autoincrement())
  Tipo          ubicaciones_inventario_Tipo?
  Observaciones String?                      @db.VarChar(255)
  Fecha         DateTime?                    @db.Date
}

model usuarios {
  UsuarioID         Int                 @id @default(autoincrement())
  Usuario           String?             @db.VarChar(255)
  Password          String?             @db.VarChar(255)
  NombreCompleto    String?             @db.VarChar(255)
  IsActive          Boolean
  IsAdmin           Boolean
  Permisos          permisos[]
  catalogo_tecnicos catalogo_tecnicos?
}

model catalogo_tecnicos {
  TecnicoID          Int                  @id @default(autoincrement())
  UsuarioID          Int                  @unique
  Codigo             String?              @db.VarChar(20)
  Telefono           String?              @db.VarChar(20)
  Observaciones      String?              @db.VarChar(255)
  IsActive           Boolean?
  FechaAlta          DateTime?            @db.Date

  usuario            usuarios             @relation(fields: [UsuarioID], references: [UsuarioID])
  inventario_tecnico inventario_tecnico[]
  servicios          servicios[]
  notificaciones     servicios_notificaciones[]
}

model inventario_tecnico {
  InventarioTecnicoID Int       @id @default(autoincrement())
  TecnicoID           Int
  RefaccionID         Int
  StockNuevo          Int       @default(0)
  StockUsado          Int       @default(0)
  FechaUltimoMov      DateTime? @db.Date
  IsActive            Int?      @db.TinyInt @default(1)

  tecnico             catalogo_tecnicos    @relation(fields: [TecnicoID], references: [TecnicoID])
  refaccion           catalogo_refacciones @relation(fields: [RefaccionID], references: [RefaccionID])

  @@unique([TecnicoID, RefaccionID])
}

model traspasos_encabezado {
  TraspasoEncabezadoID Int                  @id @default(autoincrement())
  TipoTraspaso         TipoTraspaso
  OrigenTipo           OrigenDestinoTipo
  OrigenID             Int?
  DestinoTipo          OrigenDestinoTipo
  DestinoID            Int?
  UsuarioSolicitaID    Int
  UsuarioAutorizaID    Int?
  FechaSolicitud       DateTime             @db.Date
  FechaAutorizacion    DateTime?            @db.Date
  Estatus              EstatusSolicitud     @default(Pendiente)
  Observaciones        String?              @db.VarChar(255)
  IsActive             Int?                 @db.TinyInt @default(1)

  traspasos_detalle    traspasos_detalle[]
}

model traspasos_detalle {
  TraspasoDetalleID    Int                   @id @default(autoincrement())
  TraspasoEncabezadoID Int
  RefaccionID          Int
  CantidadNuevo        Int                   @default(0)
  CantidadUsado        Int                   @default(0)
  IsActive             Int?                  @db.TinyInt @default(1)

  encabezado           traspasos_encabezado  @relation(fields: [TraspasoEncabezadoID], references: [TraspasoEncabezadoID])
  refaccion            catalogo_refacciones  @relation(fields: [RefaccionID], references: [RefaccionID])
}

model refacciones_danadas {
  RefaccionDanadaID  Int           @id @default(autoincrement())
  RefaccionID        Int
  TecnicoID          Int?
  ProveedorID        Int?
  CompraEncabezadoID Int?
  EquipoID           Int?
  Cantidad           Int
  MotivoDano         MotivoDano
  Observaciones      String?       @db.VarChar(255)
  FechaRegistro      DateTime      @db.Date
  UsuarioID          Int
  IsActive           Int?          @db.TinyInt @default(1)

  refaccion          catalogo_refacciones  @relation(fields: [RefaccionID], references: [RefaccionID])
  equipo             equipos?              @relation(fields: [EquipoID], references: [EquipoID])
}

model ajustes_inventario {
  AjusteID           Int            @id @default(autoincrement())
  TecnicoID          Int
  RefaccionID        Int
  StockSistemaNuevo  Int
  StockSistemaUsado  Int
  StockRealNuevo     Int
  StockRealUsado     Int
  DiferenciaNuevo    Int
  DiferenciaUsado    Int
  MotivoAjuste       MotivoAjuste
  Observaciones      String?        @db.VarChar(255)
  UsuarioSolicitaID  Int
  UsuarioAutorizaID  Int?
  FechaSolicitud     DateTime       @db.Date
  FechaAutorizacion  DateTime?      @db.Date
  Estatus            EstatusAjuste  @default(Pendiente)
  IsActive           Int?           @db.TinyInt @default(1)

  refaccion          catalogo_refacciones @relation(fields: [RefaccionID], references: [RefaccionID])
}

enum pagos_ReferenciaTipo {
  Compras
  Servicios
  Ventas
  Insumos
  Logistica
}

enum ubicaciones_inventario_Tipo {
  Tecnico
  Bodega
  Equipo
}

enum clientes_telefonos_Tipo {
  Trabajo
  Personal
  Otros
  Ejemplo
}

enum kardex_inventario_TipoMovimiento {
  Entrada_Compra
  Traspaso_Tecnico
  Traspaso_Bodega_Tecnico
  Traspaso_Bodega_Equipo
  Traspaso_Tecnico_Equipo
  Traspaso_Equipo
  Servicio_Consumo_Tecnico
  Servicio_Consumo_Bodega
  Servicio_Devolucion_Bodega
  Servicio_Danada
  Reacondicionamiento_Entrada
  Reacondicionamiento_Salida
  EMPTY_ENUM_VALUE @map("")
}

enum clientes_correos_TipoCorreo {
  trabajo
  personal
  otros
}

enum compras_encabezado_Estatus {
  Pendiente
  Finalizado
}

enum TipoTraspaso {
  Bodega_Tecnico
  Tecnico_Bodega
  Tecnico_Tecnico
}

enum OrigenDestinoTipo {
  Bodega
  Tecnico
}

enum EstatusSolicitud {
  Pendiente
  Autorizado
  Rechazado
}

enum MotivoDano {
  Defecto_Fabrica
  Mal_Uso
  Desgaste_Normal
  Accidente
  Otro
}

enum MotivoAjuste {
  Perdida
  Error_Captura
  Robo
  Deterioro
  Sobrante
  Otro
}

enum EstatusAjuste {
  Pendiente
  Autorizado
  Rechazado
}

model plantillas_equipo {
  PlantillaEquipoID  Int       @id @default(autoincrement())
  Codigo             String?   @db.VarChar(50)
  NombreEquipo       String    @db.VarChar(255)
  Observaciones      String?   @db.VarChar(500)
  EsExterno          Int       @default(0) @db.TinyInt
  PorcentajeVenta    Float     @default(35.00) @db.Float
  PorcentajeRenta    Float     @default(15.00) @db.Float
  IsActive           Int?      @db.TinyInt @default(1)
  FechaCreacion      DateTime  @default(now()) @db.Date
  FechaModificacion  DateTime? @db.Date

  detalles              plantillas_equipo_detalle[]
  equipos               equipos[]
  presupuestos_detalle  presupuestos_detalle[]
  contratos_equipos     contratos_equipos[]
  clientes_equipos      clientes_equipos[]
  ventas_detalle        ventas_detalle[]

  @@unique([Codigo])
}

model plantillas_equipo_detalle {
  PlantillaDetalleID Int                  @id @default(autoincrement())
  PlantillaEquipoID  Int
  RefaccionID        Int
  Cantidad           Int                  @default(1)
  IsActive           Int?                 @db.TinyInt @default(1)

  plantilla          plantillas_equipo    @relation(fields: [PlantillaEquipoID], references: [PlantillaEquipoID])
  refaccion          catalogo_refacciones @relation(fields: [RefaccionID], references: [RefaccionID])

  @@unique([PlantillaEquipoID, RefaccionID])
}

model equipos {
  EquipoID           Int       @id @default(autoincrement())
  PlantillaEquipoID  Int
  NumeroSerie        String    @unique @db.VarChar(50)
  EsExterno          Int       @default(0) @db.TinyInt
  Estatus            EstatusEquipo @default(Armado)
  Observaciones      String?   @db.VarChar(500)
  FechaCreacion      DateTime  @default(now()) @db.Date
  FechaInstalacion   DateTime? @db.Date
  FechaDesmontaje    DateTime? @db.Date
  FechaReacondicionamiento DateTime? @db.Date
  VecesReacondicionado Int     @default(0)
  UsuarioCreadorID   Int?
  IsActive           Int?      @db.TinyInt @default(1)

  // Ubicación actual del equipo (se actualiza al instalar/retirar de contrato)
  ClienteID          Int?
  SucursalID         Int?
  ContratoID         Int?

  plantilla          plantillas_equipo   @relation(fields: [PlantillaEquipoID], references: [PlantillaEquipoID])
  detalles           equipos_detalle[]
  refacciones_danadas refacciones_danadas[]
  historial          equipos_historial[]
  cliente            catalogo_clientes?  @relation(fields: [ClienteID], references: [ClienteID])
  sucursal           clientes_sucursales? @relation(fields: [SucursalID], references: [SucursalID])
  contrato_actual    contratos?          @relation("EquipoContratoActual", fields: [ContratoID], references: [ContratoID])
  contratos_equipos  contratos_equipos[]
  servicios_equipos  servicios_equipos[]
  clientes_equipos   clientes_equipos[]
  ventas_detalle     ventas_detalle[]
}

model equipos_detalle {
  EquipoDetalleID    Int       @id @default(autoincrement())
  EquipoID           Int
  RefaccionID        Int
  Cantidad           Int       @default(1)
  IsActive           Int?      @db.TinyInt @default(1)

  equipo             equipos   @relation(fields: [EquipoID], references: [EquipoID])
  refaccion          catalogo_refacciones @relation(fields: [RefaccionID], references: [RefaccionID])

  @@unique([EquipoID, RefaccionID])
}

enum EstatusEquipo {
  Armado
  Instalado
  Reacondicionado
  Desmontado
}

model equipos_historial {
  EquipoHistorialID   Int                @id @default(autoincrement())
  EquipoID            Int
  TipoAccion          TipoAccionEquipo
  EstatusAnterior     EstatusEquipo?
  EstatusNuevo        EstatusEquipo?
  Descripcion         String             @db.VarChar(500)
  DetalleJSON         String?            @db.Text
  UsuarioID           Int?
  FechaAccion         DateTime           @default(now())

  equipo              equipos            @relation(fields: [EquipoID], references: [EquipoID])

  @@index([EquipoID])
  @@index([FechaAccion])
}

enum TipoAccionEquipo {
  CREACION
  INSTALACION
  DESINSTALACION
  INICIO_REACONDICIONAMIENTO
  FIN_REACONDICIONAMIENTO
  AGREGAR_REFACCION
  MODIFICAR_REFACCION
  ELIMINAR_REFACCION
  MODIFICACION
  BAJA
  ACTIVACION
}

// =============================================
// PRESUPUESTOS
// =============================================

model presupuestos_encabezado {
  PresupuestoID         Int                      @id @default(autoincrement())
  ClienteID             Int
  SucursalID            Int?
  FechaCreacion         DateTime                 @default(now()) @db.Date
  FechaVigencia         DateTime                 @db.Date
  Estatus               EstatusPresupuesto       @default(Pendiente)
  Observaciones         String?                  @db.VarChar(500)
  UsuarioID             Int

  Subtotal              Float                    @default(0) @db.Float
  DescuentoPorcentaje   Float?                   @db.Float
  DescuentoEfectivo     Float?                   @db.Float
  GastosAdicionales     Float?                   @db.Float
  IVA                   Float                    @default(0) @db.Float
  Total                 Float                    @default(0) @db.Float

  IsActive              Int?                     @db.TinyInt @default(1)

  cliente               catalogo_clientes        @relation(fields: [ClienteID], references: [ClienteID])
  sucursal              clientes_sucursales?     @relation(fields: [SucursalID], references: [SucursalID])
  detalles              presupuestos_detalle[]
  contratos             contratos[]
  ventas                ventas_encabezado[]
}

model presupuestos_detalle {
  DetalleID             Int                      @id @default(autoincrement())
  PresupuestoID         Int
  TipoItem              TipoItemPresupuesto
  Modalidad             ModalidadPresupuesto?

  PlantillaEquipoID     Int?
  RefaccionID           Int?

  Descripcion           String?                  @db.VarChar(500)
  Cantidad              Int                      @default(1)
  PeriodoRenta          Int?                     // Meses de renta (solo para RENTA)
  PrecioUnitario        Float                    @default(0) @db.Float
  DescuentoPorcentaje   Float?                   @db.Float
  DescuentoEfectivo     Float?                   @db.Float
  Subtotal              Float                    @default(0) @db.Float

  IsActive              Int?                     @db.TinyInt @default(1)

  presupuesto           presupuestos_encabezado  @relation(fields: [PresupuestoID], references: [PresupuestoID])
  plantilla             plantillas_equipo?       @relation(fields: [PlantillaEquipoID], references: [PlantillaEquipoID])
  refaccion             catalogo_refacciones?    @relation(fields: [RefaccionID], references: [RefaccionID])
  clientes_equipos      clientes_equipos[]
  ventas_detalle        ventas_detalle[]
}

enum EstatusPresupuesto {
  Pendiente
  Enviado
  Aprobado
  Rechazado
  Vencido
}

enum TipoItemPresupuesto {
  EQUIPO_PURIFREEZE
  EQUIPO_EXTERNO
  REFACCION
  SERVICIO
}

enum ModalidadPresupuesto {
  VENTA
  RENTA
  MANTENIMIENTO
}

// =============================================
// CONTRATOS
// =============================================

model contratos {
  ContratoID              Int                    @id @default(autoincrement())
  NumeroContrato          String                 @unique @db.VarChar(20)
  PresupuestoID           Int
  ClienteID               Int
  SucursalID              Int?
  FechaInicio             DateTime               @db.Date
  FechaFin                DateTime               @db.Date
  Estatus                 EstatusContrato        @default(EN_REVISION)
  CondicionesPago         CondicionesPago        @default(MENSUAL)
  DiaPago                 Int                    @default(1)
  MontoTotal              Float                  @default(0) @db.Float
  FrecuenciaMantenimiento Int?                   // Meses entre mantenimientos
  PenalizacionCancelacion Float?                 @db.Float // Porcentaje de penalización
  MotivosCancelacion      String?                @db.VarChar(500)
  Observaciones           String?                @db.VarChar(500)
  ContratoOrigenID        Int?                   // Para renovaciones
  UsuarioID               Int
  FechaCreacion           DateTime               @default(now()) @db.Date
  IsActive                Int?                   @db.TinyInt @default(1)

  presupuesto             presupuestos_encabezado @relation(fields: [PresupuestoID], references: [PresupuestoID])
  cliente                 catalogo_clientes       @relation(fields: [ClienteID], references: [ClienteID])
  sucursal                clientes_sucursales?    @relation(fields: [SucursalID], references: [SucursalID])
  contrato_origen         contratos?              @relation("ContratoRenovacion", fields: [ContratoOrigenID], references: [ContratoID])
  contratos_renovados     contratos[]             @relation("ContratoRenovacion")
  equipos_actuales        equipos[]               @relation("EquipoContratoActual")
  equipos                 contratos_equipos[]
  historial               contratos_historial[]
  servicios               servicios[]
  notificaciones          servicios_notificaciones[] @relation("NotificacionesContrato")
  clientes_equipos        clientes_equipos[]
  cobros                  cobros[]
  cobros_configuracion    cobros_configuracion?
}

model contratos_equipos {
  ContratoEquipoID        Int                    @id @default(autoincrement())
  ContratoID              Int
  EquipoID                Int?                   // Nullable: null = pendiente de asignar
  ItemPendienteID         Int?                   // Referencia al item pendiente que satisface
  Modalidad               ModalidadContrato
  PrecioUnitario          Float                  @default(0) @db.Float
  PeriodoMeses            Int?                   // Meses para RENTA
  FechaAsignacion         DateTime               @default(now()) @db.Date
  FechaInstalacion        DateTime?              @db.Date
  FechaRetiro             DateTime?              @db.Date
  Estatus                 EstatusContratoEquipo  @default(PENDIENTE)
  Observaciones           String?                @db.VarChar(500)
  IsActive                Int?                   @db.TinyInt @default(1)

  // Datos del presupuesto (para referencia cuando EquipoID es null)
  PlantillaEquipoID       Int?
  RefaccionID             Int?
  TipoItem                String?                @db.VarChar(50) // EQUIPO_PURIFREEZE, EQUIPO_EXTERNO, REFACCION, SERVICIO
  Descripcion             String?                @db.VarChar(500)
  CantidadRequerida       Int                    @default(1)
  CantidadAsignada        Int                    @default(0)

  contrato                contratos              @relation(fields: [ContratoID], references: [ContratoID])
  equipo                  equipos?               @relation(fields: [EquipoID], references: [EquipoID])
  plantilla               plantillas_equipo?     @relation(fields: [PlantillaEquipoID], references: [PlantillaEquipoID])
  refaccion               catalogo_refacciones?  @relation(fields: [RefaccionID], references: [RefaccionID])

  // Nota: No usamos @@unique porque permitimos múltiples items con EquipoID=null (pendientes)
  // La unicidad de equipo asignado se valida en el servicio
  @@index([ContratoID])
  @@index([EquipoID])
}

// =============================================
// SERVICIOS
// =============================================

model servicios {
  ServicioID              Int                    @id @default(autoincrement())
  ContratoID              Int?                   // Opcional - solo para equipos en renta
  ClienteEquipoID         Int?                   // Equipo del cliente al que se le da servicio
  TipoServicio            TipoServicio

  // Programación
  FechaProgramada         DateTime               @db.Date
  HoraProgramada          DateTime?              @db.Time(0)
  FechaEjecucion          DateTime?              @db.Date
  HoraInicio              DateTime?              @db.Time(0)
  HoraFin                 DateTime?              @db.Time(0)

  // Asignación
  TecnicoID               Int?

  // Estados
  Estatus                 EstatusServicio        @default(POR_CONFIRMAR)

  // Configuración de inventario
  OrigenInventario        OrigenInventarioServicio @default(TECNICO)

  // Observaciones
  ObservacionesAntes      String?                @db.VarChar(500)
  ObservacionesDespues    String?                @db.VarChar(500)
  ObservacionesGenerales  String?                @db.Text

  // Reagendamiento / Próximo servicio
  ProximoServicioMeses    Int?
  ServicioOrigenID        Int?
  MotivoReagendamiento    String?                @db.VarChar(255)
  MotivoCancelacion       String?                @db.VarChar(255)

  // Costos
  CostoServicio           Float                  @default(0) @db.Float
  CostoRefacciones        Float                  @default(0) @db.Float
  CostoTotal              Float                  @default(0) @db.Float

  // Auditoría
  UsuarioCreadorID        Int?
  UsuarioFinalizaID       Int?
  FechaCreacion           DateTime               @default(now())
  FechaModificacion       DateTime?              @updatedAt
  IsActive                Int?                   @db.TinyInt @default(1)

  // Relaciones
  contrato                contratos?             @relation(fields: [ContratoID], references: [ContratoID])
  cliente_equipo          clientes_equipos?      @relation(fields: [ClienteEquipoID], references: [ClienteEquipoID])
  tecnico                 catalogo_tecnicos?     @relation(fields: [TecnicoID], references: [TecnicoID])
  servicio_origen         servicios?             @relation("ServicioReagendado", fields: [ServicioOrigenID], references: [ServicioID])
  servicios_reagendados   servicios[]            @relation("ServicioReagendado")
  equipos                 servicios_equipos[]
  insumos                 servicios_insumos[]
  historial               servicios_historial[]
  notificaciones          servicios_notificaciones[]
  firmas                  servicios_firmas[]

  @@index([ContratoID])
  @@index([ClienteEquipoID])
  @@index([TecnicoID])
  @@index([FechaProgramada])
  @@index([Estatus])
}

model servicios_equipos {
  ServicioEquipoID        Int                    @id @default(autoincrement())
  ServicioID              Int
  ClienteEquipoID         Int?
  EquipoID                Int?

  // Para desinstalación
  AccionDesinstalacion    AccionDesinstalacion?

  // Observaciones
  Observaciones           String?                @db.VarChar(500)

  // Auditoría
  IsActive                Int?                   @db.TinyInt @default(1)

  // Relaciones
  servicio                servicios              @relation(fields: [ServicioID], references: [ServicioID])
  cliente_equipo          clientes_equipos?      @relation(fields: [ClienteEquipoID], references: [ClienteEquipoID])
  equipo                  equipos?               @relation(fields: [EquipoID], references: [EquipoID])
  refacciones             servicios_equipos_refacciones[]

  @@index([ServicioID])
  @@index([EquipoID])
  @@index([ClienteEquipoID])
}

model servicios_equipos_refacciones {
  ServicioEquipoRefaccionID Int                  @id @default(autoincrement())
  ServicioEquipoID        Int
  RefaccionID             Int

  // Cantidades
  CantidadEquipo          Int                    @default(0)
  CantidadTecnico         Int                    @default(0)

  // Acciones realizadas
  Cambio                  Int                    @default(0) @db.TinyInt
  Limpieza                Int                    @default(0) @db.TinyInt
  Verificacion            Int                    @default(0) @db.TinyInt

  // Si hubo cambio
  RefaccionNuevaID        Int?
  CantidadNueva           Int                    @default(0)

  // Para desinstalación
  DestinoRefaccion        DestinoRefaccion?
  MotivoDano              MotivoDano?
  ObservacionesDano       String?                @db.VarChar(255)

  // Observaciones
  Observaciones           String?                @db.VarChar(255)

  // Auditoría
  IsActive                Int?                   @db.TinyInt @default(1)

  // Relaciones
  servicio_equipo         servicios_equipos      @relation(fields: [ServicioEquipoID], references: [ServicioEquipoID])
  refaccion               catalogo_refacciones   @relation("RefaccionOriginal", fields: [RefaccionID], references: [RefaccionID])
  refaccion_nueva         catalogo_refacciones?  @relation("RefaccionNueva", fields: [RefaccionNuevaID], references: [RefaccionID])

  @@index([ServicioEquipoID])
  @@index([RefaccionID])
}

model servicios_insumos {
  ServicioInsumoID        Int                    @id @default(autoincrement())
  ServicioID              Int
  RefaccionID             Int

  // Cantidad
  Cantidad                Int                    @default(1)

  // Origen
  OrigenInventario        OrigenInventarioServicio @default(TECNICO)

  // Costos
  CostoUnitario           Float                  @default(0) @db.Float
  Subtotal                Float                  @default(0) @db.Float

  // Observaciones
  Observaciones           String?                @db.VarChar(255)

  // Auditoría
  IsActive                Int?                   @db.TinyInt @default(1)

  // Relaciones
  servicio                servicios              @relation(fields: [ServicioID], references: [ServicioID])
  refaccion               catalogo_refacciones   @relation(fields: [RefaccionID], references: [RefaccionID])

  @@index([ServicioID])
}

model servicios_historial {
  HistorialID             Int                    @id @default(autoincrement())
  ServicioID              Int

  TipoAccion              TipoAccionServicio

  Descripcion             String                 @db.VarChar(500)
  ValorAnterior           String?                @db.Text
  ValorNuevo              String?                @db.Text

  UsuarioID               Int
  FechaAccion             DateTime               @default(now())

  // Relaciones
  servicio                servicios              @relation(fields: [ServicioID], references: [ServicioID])

  @@index([ServicioID])
  @@index([FechaAccion])
}

model servicios_notificaciones {
  NotificacionID          Int                    @id @default(autoincrement())
  ServicioID              Int?
  ContratoID              Int?

  Tipo                    TipoNotificacionServicio

  Titulo                  String                 @db.VarChar(255)
  Mensaje                 String?                @db.Text

  FechaNotificacion       DateTime               @db.Date
  FechaVisto              DateTime?

  // Destino
  UsuarioDestinoID        Int?
  TecnicoDestinoID        Int?

  // Estado
  Estatus                 EstatusNotificacion    @default(PENDIENTE)

  // Auditoría
  IsActive                Int?                   @db.TinyInt @default(1)
  FechaCreacion           DateTime               @default(now())

  // Relaciones
  servicio                servicios?             @relation(fields: [ServicioID], references: [ServicioID])
  contrato                contratos?             @relation("NotificacionesContrato", fields: [ContratoID], references: [ContratoID])
  tecnico                 catalogo_tecnicos?     @relation(fields: [TecnicoDestinoID], references: [TecnicoID])

  @@index([FechaNotificacion])
  @@index([Estatus])
  @@index([UsuarioDestinoID])
}

model servicios_firmas {
  FirmaID                 Int                    @id @default(autoincrement())
  ServicioID              Int

  TipoFirma               TipoFirma
  NombreFirmante          String                 @db.VarChar(255)

  FirmaData               String?                @db.MediumText
  FirmaArchivo            String?                @db.VarChar(255)

  FechaFirma              DateTime               @default(now())
  IpAddress               String?                @db.VarChar(45)

  // Auditoría
  IsActive                Int?                   @db.TinyInt @default(1)

  // Relaciones
  servicio                servicios              @relation(fields: [ServicioID], references: [ServicioID])

  @@index([ServicioID])
}

model contratos_historial {
  HistorialID             Int                    @id @default(autoincrement())
  ContratoID              Int
  TipoAccion              TipoAccionContrato
  Descripcion             String                 @db.VarChar(500)
  ValorAnterior           String?                @db.Text
  ValorNuevo              String?                @db.Text
  UsuarioID               Int
  FechaAccion             DateTime               @default(now())

  contrato                contratos              @relation(fields: [ContratoID], references: [ContratoID])
}

// Enums de Contratos
enum EstatusContrato {
  EN_REVISION
  ACTIVO
  VENCIDO
  CANCELADO
  RENOVADO
}

enum CondicionesPago {
  MENSUAL
  TRIMESTRAL
  SEMESTRAL
  ANUAL
}

enum ModalidadContrato {
  VENTA
  RENTA
  COMODATO
  MANTENIMIENTO
}

enum EstatusContratoEquipo {
  PENDIENTE
  INSTALADO
  RETIRADO
}

// Enums de Servicios
enum TipoServicio {
  INSTALACION
  MANTENIMIENTO
  REPARACION
  DESINSTALACION
}

enum EstatusServicio {
  POR_CONFIRMAR
  PENDIENTE
  CONFIRMADO
  EN_PROCESO
  REALIZADO
  CANCELADO
}

enum OrigenInventarioServicio {
  TECNICO
  BODEGA
}

enum AccionDesinstalacion {
  PIEZAS_INDIVIDUALES
  EQUIPO_COMPLETO
}

enum DestinoRefaccion {
  INVENTARIO
  DANADA
  PERMANECE
}

enum TipoAccionServicio {
  CREACION
  ASIGNACION_TECNICO
  CAMBIO_ESTATUS
  REAGENDAMIENTO
  CANCELACION
  AGREGAR_EQUIPO
  QUITAR_EQUIPO
  AGREGAR_INSUMO
  MODIFICACION_REFACCION
  FINALIZACION
  MODIFICACION
}

enum TipoNotificacionServicio {
  RECORDATORIO_SERVICIO
  CONFIRMACION_PENDIENTE
  SERVICIO_PROXIMO
  MANTENIMIENTO_PROGRAMADO
  CONTRATO_POR_VENCER
}

enum EstatusNotificacion {
  PENDIENTE
  VISTA
  DESCARTADA
}

enum TipoFirma {
  CLIENTE
  TECNICO
}

enum TipoAccionContrato {
  CREACION
  ACTIVACION
  ACTUALIZACION_MONTO
  AGREGAR_EQUIPO
  RETIRAR_EQUIPO
  CANCELACION
  RENOVACION
  MODIFICACION
}

// =============================================
// CLIENTES EQUIPOS (Equipos asignados a clientes)
// =============================================

model clientes_equipos {
  ClienteEquipoID       Int                     @id @default(autoincrement())
  ClienteID             Int
  SucursalID            Int?

  // Equipo físico (Purifreeze) o plantilla (externos)
  EquipoID              Int?                    // FK equipos (para Purifreeze vendidos/rentados)
  PlantillaEquipoID     Int?                    // FK plantillas (para externos o referencia)

  // Clasificación
  TipoPropiedad         TipoPropiedad

  // Vínculos opcionales
  ContratoID            Int?                    // Solo si es RENTA
  PresupuestoDetalleID  Int?                    // Origen del presupuesto
  VentaDetalleID        Int?                    // Si viene de una venta

  // Datos del equipo externo (si aplica)
  DescripcionEquipo     String?                 @db.VarChar(255)
  NumeroSerieExterno    String?                 @db.VarChar(100)
  MarcaEquipo           String?                 @db.VarChar(100)
  ModeloEquipo          String?                 @db.VarChar(100)

  // Datos de contrato (para RENTA)
  Modalidad             ModalidadContrato?      // RENTA, VENTA, etc.
  TipoItem              String?                 @db.VarChar(50) // EQUIPO_PURIFREEZE, EQUIPO_EXTERNO, REFACCION, SERVICIO
  PrecioUnitario        Float?                  @db.Float
  PeriodoMeses          Int?                    // Para rentas

  // Control
  FechaAsignacion       DateTime                @default(now()) @db.Date
  FechaInstalacion      DateTime?               @db.Date
  FechaRetiro           DateTime?               @db.Date
  MotivoRetiro          String?                 @db.VarChar(255)
  Estatus               EstatusClienteEquipo    @default(ACTIVO)
  Observaciones         String?                 @db.VarChar(500)

  // Auditoría
  UsuarioAsignaID       Int?
  IsActive              Int?                    @db.TinyInt @default(1)

  // Relaciones
  cliente               catalogo_clientes       @relation(fields: [ClienteID], references: [ClienteID])
  sucursal              clientes_sucursales?    @relation(fields: [SucursalID], references: [SucursalID])
  equipo                equipos?                @relation(fields: [EquipoID], references: [EquipoID])
  plantilla             plantillas_equipo?      @relation(fields: [PlantillaEquipoID], references: [PlantillaEquipoID])
  contrato              contratos?              @relation(fields: [ContratoID], references: [ContratoID])
  presupuesto_detalle   presupuestos_detalle?   @relation(fields: [PresupuestoDetalleID], references: [DetalleID])
  venta_detalle         ventas_detalle?         @relation(fields: [VentaDetalleID], references: [VentaDetalleID])
  servicios             servicios[]             // Servicios directos a este equipo
  servicios_equipos     servicios_equipos[]     // Equipos en servicios (por detalle)
  cobros                cobros[]                // Cobros asociados a este equipo

  @@index([ClienteID])
  @@index([EquipoID])
  @@index([Estatus])
}

enum TipoPropiedad {
  RENTA
  COMPRA
  EXTERNO
}

enum EstatusClienteEquipo {
  ACTIVO
  PENDIENTE_INSTALACION  // Equipo asignado pero pendiente de instalar
  INSTALADO              // Equipo instalado en cliente
  RETIRADO
  DEVUELTO               // Para rentas devueltas
  VENDIDO                // Si se vendió posteriormente
}

// =============================================
// VENTAS (Equipos y Refacciones)
// =============================================

model ventas_encabezado {
  VentaID               Int                     @id @default(autoincrement())
  NumeroVenta           String                  @unique @db.VarChar(20)
  ClienteID             Int
  SucursalID            Int?
  PresupuestoID         Int?                    // Origen del presupuesto (si aplica)

  // Fechas
  FechaVenta            DateTime                @default(now()) @db.Date

  // Totales
  Subtotal              Float                   @default(0) @db.Float
  DescuentoPorcentaje   Float?                  @db.Float
  DescuentoEfectivo     Float?                  @db.Float
  IVA                   Float                   @default(0) @db.Float
  Total                 Float                   @default(0) @db.Float

  // Estado
  Estatus               EstatusVenta            @default(PENDIENTE)

  // Observaciones
  Observaciones         String?                 @db.VarChar(500)

  // Auditoría
  UsuarioID             Int
  FechaCreacion         DateTime                @default(now())
  IsActive              Int?                    @db.TinyInt @default(1)

  // Relaciones
  cliente               catalogo_clientes       @relation(fields: [ClienteID], references: [ClienteID])
  sucursal              clientes_sucursales?    @relation(fields: [SucursalID], references: [SucursalID])
  presupuesto           presupuestos_encabezado? @relation(fields: [PresupuestoID], references: [PresupuestoID])
  detalles              ventas_detalle[]
  pagos                 ventas_pagos[]

  @@index([ClienteID])
  @@index([FechaVenta])
  @@index([Estatus])
}

model ventas_detalle {
  VentaDetalleID        Int                     @id @default(autoincrement())
  VentaID               Int

  // Tipo de item vendido
  TipoItem              TipoItemVenta

  // Referencias (según el tipo)
  EquipoID              Int?                    // Si es EQUIPO_PURIFREEZE
  PlantillaEquipoID     Int?                    // Si es EQUIPO_EXTERNO (referencia)
  RefaccionID           Int?                    // Si es REFACCION
  PresupuestoDetalleID  Int?                    // Origen del presupuesto

  // Descripción
  Descripcion           String?                 @db.VarChar(500)

  // Cantidades y precios
  Cantidad              Int                     @default(1)
  PrecioUnitario        Float                   @default(0) @db.Float
  DescuentoPorcentaje   Float?                  @db.Float
  DescuentoEfectivo     Float?                  @db.Float
  Subtotal              Float                   @default(0) @db.Float

  // Para equipos: número de serie
  NumeroSerie           String?                 @db.VarChar(50)

  // Garantía
  MesesGarantia         Int?                    @default(12)
  FechaFinGarantia      DateTime?               @db.Date

  // Auditoría
  IsActive              Int?                    @db.TinyInt @default(1)

  // Relaciones
  venta                 ventas_encabezado       @relation(fields: [VentaID], references: [VentaID])
  equipo                equipos?                @relation(fields: [EquipoID], references: [EquipoID])
  plantilla             plantillas_equipo?      @relation(fields: [PlantillaEquipoID], references: [PlantillaEquipoID])
  refaccion             catalogo_refacciones?   @relation(fields: [RefaccionID], references: [RefaccionID])
  presupuesto_detalle   presupuestos_detalle?   @relation(fields: [PresupuestoDetalleID], references: [DetalleID])
  clientes_equipos      clientes_equipos[]      // Equipos asignados al cliente desde esta venta

  @@index([VentaID])
  @@index([EquipoID])
}

model ventas_pagos {
  VentaPagoID           Int                     @id @default(autoincrement())
  VentaID               Int

  // Pago
  MetodoPagoID          Int
  Monto                 Float                   @db.Float
  FechaPago             DateTime                @db.Date
  Referencia            String?                 @db.VarChar(100)

  // Observaciones
  Observaciones         String?                 @db.VarChar(255)

  // Auditoría
  UsuarioID             Int
  FechaRegistro         DateTime                @default(now())
  IsActive              Int?                    @db.TinyInt @default(1)

  // Relaciones
  venta                 ventas_encabezado       @relation(fields: [VentaID], references: [VentaID])

  @@index([VentaID])
}

enum TipoItemVenta {
  EQUIPO_PURIFREEZE
  EQUIPO_EXTERNO
  REFACCION
  SERVICIO
}

enum EstatusVenta {
  PENDIENTE
  PAGADA
  PARCIAL
  CANCELADA
}

// =============================================
// COBROS (Sistema de Cobranza para Rentas)
// =============================================

model cobros {
  CobroID               Int                     @id @default(autoincrement())
  ContratoID            Int
  ClienteEquipoID       Int?                    // Equipo específico (opcional)

  // Identificador único del cobro
  NumeroCobro           String                  @unique @db.VarChar(20)
  NumeroPeriodo         Int                     // Periodo 1, 2, 3... del contrato

  // Fechas
  FechaVencimiento      DateTime                @db.Date
  FechaPago             DateTime?               @db.Date

  // Montos
  MontoOriginal         Float                   @db.Float  // Monto original del cobro
  MontoDescuento        Float?                  @db.Float  // Descuento aplicado
  MontoPromocion        Float?                  @db.Float  // Promoción aplicada
  MontoFinal            Float                   @db.Float  // Monto final a pagar
  MontoPagado           Float?                  @db.Float  // Monto efectivamente pagado

  // Estado del cobro
  Estatus               EstatusCobro            @default(PENDIENTE)

  // Si es regalo/promoción
  MotivoEspecial        MotivoCobroEspecial?    // REGALO, PROMOCION, DESCUENTO
  DescripcionMotivo     String?                 @db.VarChar(255)

  // Pago
  MetodoPagoID          Int?
  Referencia            String?                 @db.VarChar(100)

  // Motivo cancelación
  MotivoCancelacion     String?                 @db.VarChar(255)

  // Observaciones
  Observaciones         String?                 @db.VarChar(500)

  // Auditoría
  UsuarioCreadorID      Int?
  UsuarioPagoID         Int?                    // Usuario que registró el pago
  FechaCreacion         DateTime                @default(now())
  FechaModificacion     DateTime?               @updatedAt
  IsActive              Int?                    @db.TinyInt @default(1)

  // Relaciones
  contrato              contratos               @relation(fields: [ContratoID], references: [ContratoID])
  cliente_equipo        clientes_equipos?       @relation(fields: [ClienteEquipoID], references: [ClienteEquipoID])
  historial             cobros_historial[]

  @@index([ContratoID])
  @@index([FechaVencimiento])
  @@index([Estatus])
}

model cobros_historial {
  HistorialID           Int                     @id @default(autoincrement())
  CobroID               Int

  TipoAccion            TipoAccionCobro

  Descripcion           String                  @db.VarChar(500)
  ValorAnterior         String?                 @db.Text
  ValorNuevo            String?                 @db.Text

  UsuarioID             Int
  FechaAccion           DateTime                @default(now())

  // Relaciones
  cobro                 cobros                  @relation(fields: [CobroID], references: [CobroID])

  @@index([CobroID])
  @@index([FechaAccion])
}

// Configuración de generación de cobros por contrato
model cobros_configuracion {
  ConfiguracionID       Int                     @id @default(autoincrement())
  ContratoID            Int                     @unique

  // Fechas de generación
  FechaInicialCobros    DateTime                @db.Date

  // Monto por cobro
  MontoCobro            Float                   @db.Float

  // Configuración de tiempo
  TipoTiempoContrato    TipoTiempo              // ANIOS, MESES
  TiempoContrato        Int                     // 1 año, 2 años, etc.

  // Frecuencia de cobro
  FrecuenciaCobro       FrecuenciaCobro         // MENSUAL, BIMESTRAL, TRIMESTRAL, SEMESTRAL, ANUAL
  TiempoFrecuencia      Int                     @default(1) // Cada cuántos periodos

  // Cálculo: Total de cobros
  TotalCobros           Int                     // Número total de cobros a generar
  CobrosGenerados       Int                     @default(0) // Cobros ya generados

  // Observaciones
  Observaciones         String?                 @db.VarChar(500)

  // Auditoría
  UsuarioID             Int
  FechaCreacion         DateTime                @default(now())
  IsActive              Int?                    @db.TinyInt @default(1)

  // Relaciones
  contrato              contratos               @relation(fields: [ContratoID], references: [ContratoID])

  @@index([ContratoID])
}

enum EstatusCobro {
  PENDIENTE
  PAGADO
  PARCIAL
  VENCIDO
  REGALADO
  PROMOCION
  CANCELADO
}

enum MotivoCobroEspecial {
  REGALO
  PROMOCION
  DESCUENTO
  BONIFICACION
  CORTESIA
}

enum TipoAccionCobro {
  CREACION
  PAGO
  PAGO_PARCIAL
  REGALO
  PROMOCION
  DESCUENTO
  CANCELACION
  MODIFICACION
  VENCIMIENTO
}

enum TipoTiempo {
  ANIOS
  MESES
  SEMANAS
  DIAS
}

enum FrecuenciaCobro {
  SEMANAL
  QUINCENAL
  MENSUAL
  BIMESTRAL
  TRIMESTRAL
  SEMESTRAL
  ANUAL
}
